# QRadar Universal Audit Rules v2.0.0
# MITRE ATT&CK Framework Aligned

# Basic configuration
-D
-b 8192
-f 1
--loginuid-immutable

# Identity and Access Management
-w /etc/group -p wa -k iam_changes
-w /etc/passwd -p wa -k iam_changes
-w /etc/gshadow -p wa -k iam_changes
-w /etc/shadow -p wa -k iam_changes
-w /etc/security/opasswd -p r -k opasswd_read
-w /etc/sudoers -p wa -k sudoers_changes
-w /etc/sudoers.d/ -p wa -k sudoers_d_changes
-w /var/log/tallylog -p wa -k login_failures
-w /var/run/faillock/ -p wa -k login_failures

# System and Service Configuration
-w /etc/sysctl.conf -p wa -k sysctl_changes
-w /etc/ssh/sshd_config -p wa -k sshd_config_changes
-w /etc/systemd/ -p wa -k systemd_changes
-w /etc/cron.allow -p wa -k cron_allow_changes
-w /etc/cron.deny -p wa -k cron_deny_changes
-w /etc/at.allow -p wa -k at_allow_changes
-w /etc/at.deny -p wa -k at_deny_changes

# Kernel and Modules
-a always,exit -F arch=b64 -S init_module -S finit_module -S delete_module -k kernel_modules
-a always,exit -F arch=b32 -S init_module -S finit_module -S delete_module -k kernel_modules
-w /sbin/insmod -p x -k kernel_modules
-w /sbin/rmmod -p x -k kernel_modules
-w /sbin/modprobe -p x -k kernel_modules

# Privilege Escalation and Command Execution
-a always,exit -F arch=b64 -S execve -k command_execution
-a always,exit -F arch=b32 -S execve -k command_execution
-a always,exit -F arch=b64 -S setuid -S setgid -S setreuid -S setregid -k privilege_escalation
-a always,exit -F arch=b32 -S setuid -S setgid -S setreuid -S setregid -k privilege_escalation
-a always,exit -F path=/usr/bin/sudo -F perm=x -k sudo_execution
-a always,exit -F path=/usr/bin/su -F perm=x -k su_execution

# File System Operations
-a always,exit -F arch=b64 -S unlink -S unlinkat -S rename -S renameat -F auid>=1000 -F auid!=4294967295 -k file_modification
-a always,exit -F arch=b32 -S unlink -S unlinkat -S rename -S renameat -F auid>=1000 -F auid!=4294967295 -k file_modification

# Network Operations
-a always,exit -F arch=b64 -S socket -S connect -S accept -S bind -k network_activity
-a always,exit -F arch=b32 -S socket -S connect -S accept -S bind -k network_activity

# MITRE ATT&CK TTPs
-w /root/.bash_history -p wa -k T1070_bash_history
-w /home/*/.bash_history -p wa -k T1070_bash_history
-w /etc/crontab -p wa -k T1053_scheduled_task
-w /etc/cron.d/ -p wa -k T1053_scheduled_task
-w /etc/cron.hourly/ -p wa -k T1053_scheduled_task
-w /etc/cron.daily/ -p wa -k T1053_scheduled_task
-w /etc/cron.weekly/ -p wa -k T1053_scheduled_task
-w /etc/cron.monthly/ -p wa -k T1053_scheduled_task
-w /var/spool/cron/ -p wa -k T1053_scheduled_task

# Immutable
-e 2
