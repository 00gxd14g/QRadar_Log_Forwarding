# QRadar Log Forwarding Configuration v4.2.1
# This file is placed in /etc/rsyslog.d/

# Input for audit logs from auditd
if $programname == 'audit' or $syslogfacility-text == 'local3' then {
    # Create a copy for EXECVE processing if needed
    if ($msg contains 'type=EXECVE') then {
        action(type="omprogram"
               binary="/usr/local/bin/qradar_execve_parser.py")
    }
    
    # Forward to QRadar with LEEF format
    action(type="omfwd"
           Target="<QRADAR_IP>"
           Port="<QRADAR_PORT>"
           Protocol="tcp"
           queue.type="linkedList"
           queue.filename="qradar_audit_fwd"
           action.resumeRetryCount="-1")
    stop
}

# Handle other system logs
*.* @@<QRADAR_IP>:<QRADAR_PORT>
